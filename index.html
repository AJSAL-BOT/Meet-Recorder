<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Meet Auto Recorder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #121212;
            color: #fff;
        }
        input, button {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
        }
        #timer {
            font-size: 20px;
            margin-top: 10px;
        }
        video {
            width: 90%;
            max-width: 600px;
            margin-top: 20px;
            border: 2px solid #00ffcc;
            border-radius: 10px;
        }
    </style>
</head>
<body>

    <h2>Google Meet Auto Recorder</h2>
    
    <input type="text" id="meetCode" placeholder="Enter Google Meet Code">
    <br>
    <button id="joinAndRecord">Join Meet & Start Recording</button>
    <button id="stopRecord" style="display: none;">Stop Recording</button>
    
    <p id="timer">Recording Time: 00:00:00</p>
    
    <video id="recordedVideo" controls style="display: none;"></video>

    <script>
        let mediaRecorder;
        let recordedChunks = [];
        let startTime;
        let timerInterval;

        document.getElementById("joinAndRecord").addEventListener("click", async () => {
            let meetCode = document.getElementById("meetCode").value.trim();
            if (meetCode === "") {
                alert("Please enter a Google Meet code!");
                return;
            }

            // Open Google Meet in a new tab
            let meetUrl = `https://meet.google.com/${meetCode}`;
            let meetTab = window.open(meetUrl, "_blank");

            // Wait for 5 seconds before recording
            setTimeout(async () => {
                try {
                    let stream = await navigator.mediaDevices.getDisplayMedia({
                        video: { mediaSource: "browser" }, 
                        audio: true
                    });

                    mediaRecorder = new MediaRecorder(stream);
                    recordedChunks = [];

                    mediaRecorder.ondataavailable = event => {
                        if (event.data.size > 0) {
                            recordedChunks.push(event.data);
                        }
                    };

                    mediaRecorder.onstop = saveRecording;

                    mediaRecorder.start();
                    startTime = Date.now();
                    startTimer();

                    document.getElementById("joinAndRecord").style.display = "none";
                    document.getElementById("stopRecord").style.display = "inline";
                } catch (err) {
                    alert("Screen recording permission denied!");
                    console.error(err);
                }
            }, 5000); // Wait 5 seconds before recording
        });

        document.getElementById("stopRecord").addEventListener("click", () => {
            mediaRecorder.stop();
            stopTimer();
        });

        function saveRecording() {
            let blob = new Blob(recordedChunks, { type: "video/webm" });
            let url = URL.createObjectURL(blob);

            let videoElement = document.getElementById("recordedVideo");
            videoElement.src = url;
            videoElement.style.display = "block";

            let a = document.createElement("a");
            a.href = url;
            a.download = "meet_recording.webm";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            document.getElementById("joinAndRecord").style.display = "inline";
            document.getElementById("stopRecord").style.display = "none";
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                let elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                let hours = Math.floor(elapsedTime / 3600);
                let minutes = Math.floor((elapsedTime % 3600) / 60);
                let seconds = elapsedTime % 60;
                document.getElementById("timer").textContent = `Recording Time: ${String(hours).padStart(2, "0")}:${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }
    </script>

</body>
</html>
